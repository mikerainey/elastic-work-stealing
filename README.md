# Elastic work stealing

## Setup

In a new folder, e.g., `elastic`, clone the following repositories.

```
$ mkdir elastic
$ cd elastic
$ git clone git@github.com:mikerainey/elastic-work-stealing
$ git clone git@github.com:mikerainey/mcsl
$ git clone git@github.com:mikerainey/pbbslib.git
$ git clone git@github.com:mikerainey/pbbsbench.git
$ git clone git@github.com:shwestrick/mini-uts.git
```

### Building and experimenting with binaries using nix

Using nix, we can start working on benchmarks by switching the `cpp` folder
and loading the nix shell, as follows.


```
$ cd elastic-work-stealing/cpp
$ nix-shell
```

### Running experiments using nix

To start, we need to build the whole benchmarking package.

```
$ cd elastic-work-stealing/nix
$ nix-build
```

If successful, there will appear a new symlink named `result`, which 
points to the root of the package. Next, we need to generate the 
input data. It should be necessary to run this command only once,
unless we have to add new input data. This command by default ouputs
the files to `/var/tmp/infiles`.


```
$ ./result/pbench gen-inputs
```

Now, we can run the experiments, as follows.

```
./result/pbench baseline
./result/pbench elastic_exectime
./result/pbench sleeptime
```

Each of these commands will run only one time per data point. Ordinarily,
however, we may want to run multiple times for each data point, and ultimately
report the means. To do that, add the flag `-runs 5` to specify, for example,
five runs be collected for each data point.

If you only want to see the commands that would be executed by the benchmark
script, but not run all of them now, you can run the following. For example:

```
./result/pbench baseline -only run --virtual_run
```

### Manual

TODO

```
$ git clone git@github.com:deepsea-inria/cmdline.git
```

## Building and running benchmarks

We can now build any of the available benchmarks in this folder. For
each benchmark, we can build one of four versions:

- `opt` is most optimized, and reports minimal stats
- `sta` reports stats
- `log` generates a log output and reports stats
- `dbg` is a debugging binary, with the capabilities of `log`, and minimal optimization and maximum debugging support

### Logging

We can use the logging binary to generate utilization plots, which
help us visualize the activity of the scheduler. The plotting data can
be generated by building a logging binary and running with the flag
`--pview`, which instructs the binary to output data to be used by our
visualization tool.

```
$ make fib.log
$ ./fib.log -n 35 -proc 8 --pview
```

Now, if successful, the run of `fib.log` should have created a new
file named `LOG_BIN` in the current directory. We can now run our
(x-windows) tool, which is installed automatically by the nix shell.

```
$ pview
```

